<p-toast />
<p-confirmdialog [style]="{ width: '450px' }" />

<p-toolbar styleClass="mb-6">
    <ng-template #start>
        <div class="flex items-center gap-2">
            <i class="pi pi-shop"></i>
            <span class="font-bold">Gestão de Anúncios</span>
        </div>
    </ng-template>

    <ng-template #end>
        <p-button label="Voltar" icon="pi pi-history" severity="secondary" />
    </ng-template>
</p-toolbar>

<p-panel>
    <ng-template #header>
        <div class="flex items-center gap-2">
            <i class="pi pi-shopping-cart"></i>
            <span class="font-bold">Dados do Anúncio</span>
        </div>
    </ng-template>
    <ng-template #icons>
        <p-button icon="pi pi-thumbs-down" severity="primary" rounded text pTooltip="Denunciar" tooltipPosition="top" />
        <p-button icon="pi pi-tag" severity="info" rounded text pTooltip="Revisão Manual" tooltipPosition="top" />
    </ng-template>
    <p-fluid>
        <div class="grid grid-cols-4 gap-4">
            <div>
                <p-iftalabel>
                    <p-select [(ngModel)]="advertisement.st_status" inputId="st_status" [options]="statuses" optionLabel="label" styleClass="w-full" />
                    <label for="st_status">Status</label>
                </p-iftalabel>
            </div>
            <div>
                <p-iftalabel>
                    <input pInputText id="st_plataform" [(ngModel)]="advertisement.st_plataform" />
                    <label for="st_plataform">Plataforma</label>
                </p-iftalabel>
            </div>
            <div>
                <p-iftalabel>
                    <input pInputText id="st_plataform_id" [(ngModel)]="advertisement.st_plataform_id" />
                    <label for="st_plataform_id">Plataforma ID</label>
                </p-iftalabel>
            </div>
            <div>
                <p-iftalabel>
                    <p-inputnumber [(ngModel)]="advertisement.db_price" mode="currency" inputId="db_price" currency="BRL" locale="pt-BR" (onBlur)="printPrice()" />
                    <label for="db_price">Preço</label>
                </p-iftalabel>
            </div>

            <div class="col-span-2">
                <p-iftalabel>
                    <input pInputText id="st_name" [(ngModel)]="client.st_name" />
                    <label for="st_name">Cliente</label>
                </p-iftalabel>
            </div>
            <div>
                <p-iftalabel>
                    <input pInputText id="st_brand" [(ngModel)]="brand.st_brand" />
                    <label for="st_brand">Marca</label>
                </p-iftalabel>
            </div>
            <div>
                <p-iftalabel>
                    <input pInputText id="st_vendor" [(ngModel)]="advertisement.st_vendor" />
                    <label for="st_vendor">Vendedor</label>
                </p-iftalabel>
            </div>
            <div class="col-span-full">
                <p-galleria [value]="advertisement.st_photos?.split(',')" indicatorsPosition="left" [showIndicators]="true" [showThumbnails]="false" showIndicatorsOnItem="true" [containerStyle]="{ 'margin-top': '2em' }" >
                    <ng-template pTemplate="item" let-item>
                        <img [src]="advertisementService.getPhotoUrl(advertisement.st_plataform!, advertisement.st_plataform_id!, item)" style="width: 100%; max-width: 640px; max-height: 640px; display: block;" />
                    </ng-template>
                </p-galleria>
            </div>
            <div class="col-span-full">
                <p-iftalabel>
                    <input pInputText id="st_title" [(ngModel)]="advertisement.st_title" />
                    <label for="st_title">Título do Anúncio</label>
                </p-iftalabel>
            </div>
            <div class="col-span-full">
                <p-iftalabel>
                    <input pInputText id="st_url" [(ngModel)]="advertisement.st_url" />
                    <label for="st_url">URL</label>
                </p-iftalabel>
            </div>
            <div class="col-span-full">
                <p-iftalabel>
                    <textarea pTextarea id="st_description" [(ngModel)]="advertisement.st_description" rows="20" cols="30" style="resize: none"></textarea>
                    <label for="st_description">Descrição</label>
                </p-iftalabel>
            </div>
        </div>
    </p-fluid>
</p-panel>
<br />
<p-panel>
    <ng-template #header>
        <div class="flex items-center gap-2">
            <i class="pi pi-shopping-cart"></i>
            <span class="font-bold">Produtos</span>
        </div>
    </ng-template>
    <p-table
        #dt
        [value]="products || []"
        [rows]="50"
        [tableStyle]="{ 'min-width': '75rem' }"
        [rowHover]="true"
    >
        <ng-template #header>
            <tr>
                <th pSortableColumn="st_name" style="min-width: 10rem">
                    Categoria
                    <p-sortIcon field="st_name" />
                </th>
                <th pSortableColumn="st_brand" style="min-width: 10rem">
                    Subcategoria
                    <p-sortIcon field="st_brand" />
                </th>
                <th pSortableColumn="st_product" style="min-width: 10rem">
                    Produto
                    <p-sortIcon field="st_product" />
                </th>
                <th pSortableColumn="st_variety" style="min-width: 8rem">
                    Variedade
                    <p-sortIcon field="st_variety" />
                </th>
                <th pSortableColumn="db_price" style="min-width: 6rem">
                    Preço Base
                    <p-sortIcon field="db_price" />
                </th>
            </tr>
        </ng-template>
        <ng-template #body let-product>
            <tr>
                <td>{{ product.subcategory.category.st_category }}</td>
                <td>{{ product.subcategory.st_subcategory }}</td>
                <td>{{ product.st_product }}</td>
                <td>{{ product.st_variety_name }}</td>
                <td>{{ product.db_price | currency: 'BRL':'symbol':'1.2-2':'pt-BR' }}</td>
            </tr>
        </ng-template>
    </p-table>
</p-panel>
<br />
<p-panel>
    <ng-template #header>
        <div class="flex items-center gap-2">
            <i class="pi pi-history"></i>
            <span class="font-bold">Histórico</span>
        </div>
    </ng-template>
    <p-table
        #dt
        [value]="products || []"
        [rows]="50"
        [tableStyle]="{ 'min-width': '75rem' }"
        [rowHover]="true"
    >
        <ng-template #header>
            <tr>
                <th pSortableColumn="dt_history" style="min-width: 20rem">
                    Data
                    <p-sortIcon field="dt_history" />
                </th>
                <th pSortableColumn="st_status" style="min-width: 20rem">
                    Status
                    <p-sortIcon field="st_status" />
                </th>
                <th pSortableColumn="st_action" style="min-width:20rem">
                    Ação
                    <p-sortIcon field="st_action" />
                </th>
                <th pSortableColumn="st_history" style="min-width:20rem">
                    Histórico
                    <p-sortIcon field="st_history" />
                </th>
            </tr>
        </ng-template>
        <ng-template #body let-advertisement>
            <tr>
                <td>{{ advertisement.dt_history | date:'dd/MM/yyyy HH:mm:ss' }}</td>
                <td>{{ advertisement.st_status }}</td>
                <td>{{ advertisement.st_action }}</td>
                <td>{{ advertisement.st_history }}</td>
            </tr>
        </ng-template>
    </p-table>
</p-panel>